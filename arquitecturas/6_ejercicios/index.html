
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>Ejercicios. App con MVVM - Arquitecturas de apps iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ensamblaje-de-vista-modelo-y-viewmodel" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Arquitecturas de apps iOS" class="md-header__button md-logo" aria-label="Arquitecturas de apps iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arquitecturas de apps iOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ejercicios. App con MVVM
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Arquitecturas de apps iOS" class="md-nav__button md-logo" aria-label="Arquitecturas de apps iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Arquitecturas de apps iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Arquitecturas de aplicaciones en iOS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Arquitecturas de aplicaciones en iOS" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Arquitecturas de aplicaciones en iOS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1_intro_arquitecturas/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2_MVC/" class="md-nav__link">
        MVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3_MVP/" class="md-nav__link">
        MVP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../4_MVVM/" class="md-nav__link">
        MVVM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5_VIPER/" class="md-nav__link">
        VIPER
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Ejercicios. App con MVVM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Ejercicios. App con MVVM
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ensamblaje-de-vista-modelo-y-viewmodel" class="md-nav__link">
    Ensamblaje de vista, modelo y viewmodel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mostrar-la-descripcion-del-tiempo-05-puntos" class="md-nav__link">
    Mostrar la descripción del tiempo (0,5 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mostrar-el-icono-del-tiempo-05-puntos" class="md-nav__link">
    Mostrar el icono del tiempo (0,5 puntos)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ensamblaje-de-vista-modelo-y-viewmodel" class="md-nav__link">
    Ensamblaje de vista, modelo y viewmodel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mostrar-la-descripcion-del-tiempo-05-puntos" class="md-nav__link">
    Mostrar la descripción del tiempo (0,5 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mostrar-el-icono-del-tiempo-05-puntos" class="md-nav__link">
    Mostrar el icono del tiempo (0,5 puntos)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Ejercicios. App con MVVM</h1>
                
                <p>Queremos hacer una aplicación con arquitectura MVVM para consultar el tiempo meteorológico. El proyecto con la plantilla está en moodle. Ya tiene creadas las "carpetas" y los esqueletos de código para la vista, el modelo y el <em>viewmodel</em>. </p>
<p>De hecho el modelo ya está terminado y no es necesario que modifiques nada de <code>TiempoModel.swift</code>, aunque sí tendrás que completar la vista (<code>MainView.swift</code>) y el <em>viewmodel</em> (<code>ViewModel.swift</code>)</p>
<h2 id="ensamblaje-de-vista-modelo-y-viewmodel">Ensamblaje de vista, modelo y <em>viewmodel</em><a class="headerlink" href="#ensamblaje-de-vista-modelo-y-viewmodel" title="Permanent link">&para;</a></h2>
<p>En la clase de la vista (<code>MainView</code>) añadir una propiedad que represente al <em>viewmodel</em></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">viewModel</span> <span class="p">=</span> <span class="n">TiempoViewModel</span><span class="p">()</span>
</code></pre></div>
<p>En el <code>TiempoViewModel</code> añadir una propiedad que represente al modelo</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">modelo</span> <span class="p">=</span> <span class="n">TiempoModelo</span><span class="p">()</span>
</code></pre></div>
<h2 id="mostrar-la-descripcion-del-tiempo-05-puntos">Mostrar la descripción del tiempo (0,5 puntos)<a class="headerlink" href="#mostrar-la-descripcion-del-tiempo-05-puntos" title="Permanent link">&para;</a></h2>
<p>En este apartado conseguiremos que al pulsar en el botón "consultar tiempo" la descripción en modo texto (p.ej. "sol") aparezca en la pantalla del dispositivo.</p>
<p>En el <em>viewmodel</em>: <code>TiempoViewModel</code></p>
<ul>
<li>Añade al comienzo un <code>import Combine</code></li>
<li>Crea la propiedad que representa el estado actual del tiempo, <code>estado</code> de tipo String, asignándole como valor inicial la cadena vacía</li>
<li>Anota la propiedad con <code>@Published</code> para que se publiquen los cambios</li>
<li>crea el siguiente método, que llamará al modelo para consultar el tiempo actual</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">consultarTiempoActual</span><span class="p">(</span><span class="n">localidad</span> <span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">modelo</span><span class="p">.</span><span class="n">consultarTiempoActual</span><span class="p">(</span><span class="n">localidad</span><span class="p">:</span> <span class="n">localidad</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">estado</span><span class="p">,</span> <span class="n">urlIcono</span> <span class="k">in</span>
    <span class="n">OperationQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">addOperation</span> <span class="p">{</span>
        <span class="c1">//como al tocar estas propiedades se va a modificar la interfaz</span>
        <span class="c1">//debemos hacerlo desde el hilo principal</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">estado</span> <span class="p">=</span> <span class="n">estado</span>
        <span class="c1">//de momento no hacemos nada con `urlIcono`</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Fíjate que esta función le "pasa la pelota al modelo". Al ser una operación asíncrona, tras obtener la información, el modelo ejecuta la clausura que se le pasa como parámetro. Aquí lo que hacemos es copiar el texto del estado en la propiedad del <em>viewmodel</em> del mismo nombre.</p>
<p>En la vista: <code>MainView</code></p>
<ul>
<li>Añade al comienzo un <code>import Combine</code></li>
<li>En el <code>viewDidLoad()</code> vincula la propiedad <code>estado</code> del <em>viewmodel</em> con la propiedad <code>text</code> del label <code>estadoLabel</code></li>
<li>Ten en cuenta que debes guardar esta vinculación en alguna variable que sea una propiedad del <em>viewModel</em> para que no se "pierda" y se mantenga "activa"</li>
<li>Haz que en el método <code>botonPulsado</code> se llame a <code>consultarTiempoActual(localidad:)</code> del <em>viewmodel</em>, pasándole como parámetro lo que haya escrito el el campo de texto <code>campoTexto</code>.</li>
</ul>
<p>Si todo es correcto, al probar la <em>app</em>, escribir una localidad en el campo de texto y pulsar sobre el botón de "Ver tiempo" debería aparecer la descripción con el estado actual del tiempo en la pantalla del dispositivo.</p>
<h2 id="mostrar-el-icono-del-tiempo-05-puntos">Mostrar el icono del tiempo (0,5 puntos)<a class="headerlink" href="#mostrar-el-icono-del-tiempo-05-puntos" title="Permanent link">&para;</a></h2>
<p>Haz lo mismo para el icono del tiempo. Intenta hacer todos los pasos por tí mismo, serán similares al apartado anterior, solo que será más complicado ya que queremos vincular lo que en origen es un String con la URL a la que hay que acceder para obtener el icono del tiempo. </p>
<p>Tendrás que hacer las siguientes transformaciones:</p>
<ul>
<li>Filtrar que la URL del icono sea distinta a la cadena vacía. (operador <code>filter</code>)</li>
<li>Con el operador <code>map</code> convertir el String con la URL del icono a una <code>UIImage</code>. Tienes que hacerlo en varios pasos: String -&gt; objeto de la clase URL -&gt; datos binarios -&gt; imagen</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">lo_que_sea_la_cadena_con_la_URL</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">datos</span> <span class="p">=</span> <span class="k">try</span><span class="p">!</span> <span class="n">Data</span><span class="p">(</span><span class="n">contentsOf</span><span class="p">:</span> <span class="n">url</span><span class="p">!)</span>
<span class="k">return</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">datos</span><span class="p">)</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Pie">
      
        
        <a href="../5_VIPER/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: VIPER" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              VIPER
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>